<div class="chat-container">
  <!-- Header del chat -->
  <div class="chat-header">
    <div class="chat-user-info">
      <img [src]="chatUser.photo" alt="Foto de perfil" class="user-photo">
      <span class="user-name">{{ chatUser.name }}</span>
    </div>
  </div>

  <div class="chat-messages" #chatContainer>
    <div *ngFor="let message of messages" [@messageAnimation] [ngClass]="{'message-sent': message.quien === 0, 'message-received': message.quie !== 0}">
      <div *ngIf="message.dataRelationMessage" class="related-message">
        <span>Respuesta a: {{ message['dataRelationMessage'].txt }}</span>
      </div>
      <div class="message-content">
        <span *ngIf="!message.urlMedios">{{ message.txt }}</span>
        <img *ngIf="( message.typeTxt === 'image' ) || ( message.typeTxt === 'photo' ) " [src]="message.urlMedios" alt="imagen" class="image-message">
        <audio *ngIf="message.typeTxt === 'audio'" controls>
          <source [src]="message.typeTxt" type="audio/mp3">
        </audio>
        <video *ngIf="message.typeTxt === 'video'" controls>
          <source [src]="message.typeTxt" type="video/mp4">
        </video>
        <a *ngIf="message.typeTxt === 'application'" [href]="message.typeTxt" download="{{ message.txt }}">{{ message.fileName }}</a>

        <!-- BotÃ³n de reenviar -->
        <button (click)="forwardMessage(message)">Reenviar</button>
      </div>
    </div>
  </div>

  <div class="d-flex bd-highlight" style="background-color: #f1f1f1;">
    <div class="p-2 flex-grow-1 bd-highlight">
      <form [formGroup]="chatForm" (ngSubmit)="sendMessage()">
        <div class="input-container">

          <!-- Campo de texto para el mensaje -->
          <input
            type="text"
            formControlName="message"
            (keydown.enter)="handleEnter($event)"
            placeholder="Escribe un mensaje..."
            class="chat-input"
          />

          <!-- BotÃ³n para enviar -->
          <button type="submit">âž¤</button>
        </div>
      </form>
    </div>
    <div class="p-2 bd-highlight">
      <div class="input-container">
        <button mat-icon-button [matMenuTriggerFor]="menu" color="warn">
          <mat-icon>add_circle_outline</mat-icon>
        </button>
        <mat-menu #menu="matMenu">
          <button mat-menu-item (click)="handleFile('document')">
            <mat-icon>file_copy</mat-icon>
          </button>
          <button mat-menu-item  (click)="handleFile('video')">
            <mat-icon>movie</mat-icon>
          </button>
          <button mat-menu-item (click)="handleFile('photo')">
            <mat-icon> insert_photo</mat-icon>
          </button>
        </mat-menu>
        <!--<input type="file" (change)="handleFileInput($event)" multiple hidden #fileInput>
        <button (click)="fileInput.click()">ðŸ“Ž</button>-->

        <button (click)="toggleEmojiPicker()">ðŸ˜Š</button>
        <div *ngIf="emojiPickerVisible" #emojiPicker>
          <emoji-mart set="twitter" (emojiSelect)="addEmoji($event)" [style]="{ position: 'absolute', bottom: '73px', right: '20px' }"></emoji-mart>
        </div>
      </div>
    </div>
  </div>
</div>
